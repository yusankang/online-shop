"use strict";(self["webpackChunkonline_shop"]=self["webpackChunkonline_shop"]||[]).push([[320],{4189:function(e,t,a){var s=a(9876),l=a(6154),o=a(6294);const i=(0,o.Z)();t["Z"]=(0,s.Q_)("dashboardStore",{state:()=>({products:[],coupons:[],orders:[],pagination:{},screenLg:!1,screenWidth:0,activePage:""}),actions:{getProducts(e=1){const t=`https://vue3-course-api.hexschool.io/api/yusan-api/admin/products/?page=${e}`;i.isLoading=!0,l.Z.get(t).then((e=>{i.isLoading=!1;const{message:t}=e.data;e.data.success?(this.products=e.data.products,this.pagination=e.data.pagination):e.data.success||i.pushMessage({title:t,style:"danger"})})).catch((e=>{throw new Error(e)}))},getCoupons(){i.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/yusan-api/admin/coupons";l.Z.get(e).then((e=>{i.isLoading=!1;const{message:t}=e.data;e.data.success?this.coupons=e.data.coupons:e.data.success||i.pushMessage({title:t,style:"danger"})})).catch((e=>{throw new Error(e)}))},getOrders(e=1){const t=`https://vue3-course-api.hexschool.io/api/yusan-api/admin/orders/?page=${e}`;i.isLoading=!0,l.Z.get(t).then((e=>{i.isLoading=!1;const{message:t}=e.data;e.data.success?(this.orders=e.data.orders,this.pagination=e.data.pagination):e.data.success||i.pushMessage({title:t,style:"danger"})})).catch((e=>{throw new Error(e)}))},deleteItem(e,t){i.isLoading=!0,l.Z["delete"](t).then((t=>{const{message:a}=t.data;t.data.success?(i.isLoading=!1,i.pushMessage({title:a}),"product"===e?this.getProducts():"coupon"===e?this.getCoupons():"order"===e&&this.getOrders()):t.data.success||i.pushMessage({title:a,style:"danger"})})).catch((e=>{throw new Error(e)}))},sendUpdate(e,t,a,s){i.isLoading=!0,l.Z[a](t,{data:s}).then((t=>{i.isLoading=!1;const{message:a}=t.data;t.data.success?(i.pushMessage({title:a}),"product"===e?this.getProducts():"coupon"===e?this.getCoupons():"paid"===e&&this.getOrders()):t.data.success||i.pushMessage({title:a,style:"danger"})})).catch((e=>{throw new Error(e)}))},onScreenResize(){window.addEventListener("resize",(()=>{this.updateScreenWidth()}))},updateScreenWidth(){this.screenWidth=window.innerWidth,this.screenWidth>=768?this.screenLg=!0:this.screenWidth<768&&(this.screenLg=!1)},setActivePage(e){this.activePage=e}}})},640:function(e,t,a){a.d(t,{Z:function(){return y}});var s=a(6252),l=a(3577),o=a(9963);const i={"aria-label":"Page navigation example"},d={class:"pagination justify-content-center"},n={class:"page-item"},r=(0,s._)("span",{"aria-hidden":"true"},"«",-1),c=[r],u=["onClick"],p={class:"page-item"},m=(0,s._)("span",{"aria-hidden":"true"},"»",-1),g=[m];function h(e,t,a,r,m,h){return(0,s.wg)(),(0,s.iD)("nav",i,[(0,s._)("ul",d,[(0,s._)("li",n,[(0,s._)("a",{class:(0,l.C_)(["page-link",{disabled:1===a.pages.current_page}]),href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,o.iM)(((...e)=>h.prevButton&&h.prevButton(...e)),["prevent"]))},c,2)]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.pages.total_pages,(e=>((0,s.wg)(),(0,s.iD)("li",{class:(0,l.C_)(["page-item",{active:e===a.pages.current_page}]),key:e},[(0,s._)("a",{class:"page-link",href:"#",onClick:(0,o.iM)((t=>h.updatePage(e)),["prevent"])},(0,l.zw)(e),9,u)],2)))),128)),(0,s._)("li",p,[(0,s._)("a",{class:(0,l.C_)(["page-link",{disabled:a.pages.current_page===a.pages.total_pages}]),href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,o.iM)(((...e)=>h.nextButton&&h.nextButton(...e)),["prevent"]))},g,2)])])])}var b={props:{pages:{type:Object,default(){return{}}}},methods:{updatePage(e){this.$emit("emit-pages",e)},nextButton(){const e=this.pages.current_page+1;this.updatePage(e)},prevButton(){const e=this.pages.current_page-1;this.updatePage(e)}}},_=a(3744);const f=(0,_.Z)(b,[["render",h]]);var y=f},2320:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ee}});var s=a(6252),l=a(3577);const o=(0,s._)("h5",{class:"text-center mt-4"},"商品列表",-1),i={class:"d-grid d-md-flex justify-content-md-end"},d={key:0,class:"table table-sm table-hover mt-4"},n=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",{width:"80"},"分類"),(0,s._)("th",null,"產品名稱"),(0,s._)("th",{width:"100"},"原價"),(0,s._)("th",{width:"100"},"售價"),(0,s._)("th",{width:"100"},"是否啟用"),(0,s._)("th",{width:"160"},"編輯")])],-1),r={class:"table-group-divider"},c={class:"text-right"},u={class:"text-right"},p={key:0,class:"text-success"},m={key:1,class:"text-mute"},g={class:"btn-group"},h=["onClick"],b=["onClick"],_={key:1,class:"table table-sm mt-4 table-bordered border-dark"},f={class:"d-flex flex-column"},y={class:"d-flex justify-content-between"},v={class:"btn-group"},w=["onClick"],P=["onClick"],k={class:"me-3"},x={key:0,class:"text-success"},M={key:1,class:"text-mute"};function D(e,t,a,D,C,U){const W=(0,s.up)("LoadingOverlay"),L=(0,s.up)("Pagination"),I=(0,s.up)("ProductModal"),$=(0,s.up)("DeleteModal");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(W,{active:e.isLoading},null,8,["active"]),o,(0,s._)("div",i,[(0,s._)("button",{type:"button",class:"btn btn-outline-dark mt-3",onClick:t[0]||(t[0]=e=>U.openProductModal(!0))}," 新增商品 ")]),e.screenLg?((0,s.wg)(),(0,s.iD)("table",d,[n,(0,s._)("tbody",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.products,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",null,(0,l.zw)(t.category),1),(0,s._)("td",null,(0,l.zw)(t.title),1),(0,s._)("td",c,(0,l.zw)(e.$filters.currency(t.origin_price)),1),(0,s._)("td",u,(0,l.zw)(e.$filters.currency(t.price)),1),(0,s._)("td",null,[t.is_enabled?((0,s.wg)(),(0,s.iD)("span",p,"啟用")):((0,s.wg)(),(0,s.iD)("span",m,"未啟用"))]),(0,s._)("td",null,[(0,s._)("div",g,[(0,s._)("button",{type:"button",class:"btn btn-outline-dark btn-sm",onClick:e=>U.openProductModal(!1,t)}," 編輯 ",8,h),(0,s._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>U.openDeleteModal(t)}," 刪除 ",8,b)])])])))),128))])])):((0,s.wg)(),(0,s.iD)("table",_,[(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.products,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",null,[(0,s._)("div",f,[(0,s._)("div",y,[(0,s._)("strong",null,(0,l.zw)(t.title),1),(0,s._)("div",v,[(0,s._)("button",{type:"buton",class:"btn btn-outline-dark btn-sm",onClick:e=>U.openProductModal(!1,t)}," 編輯 ",8,w),(0,s._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>U.openDeleteModal(t)}," 刪除 ",8,P)])]),(0,s._)("span",k,"分類： "+(0,l.zw)(t.category),1),(0,s._)("span",null,"單價： $"+(0,l.zw)(e.$filters.currency(t.origin_price)),1),(0,s._)("span",null,"售價： $"+(0,l.zw)(e.$filters.currency(t.price)),1),t.is_enabled?((0,s.wg)(),(0,s.iD)("span",x,"啟用")):((0,s.wg)(),(0,s.iD)("span",M,"未啟用"))])])])))),128))])])),(0,s.Wm)(L,{pages:e.pagination,onEmitPages:e.getProducts},null,8,["pages","onEmitPages"]),(0,s.Wm)(I,{ref:"productModal",product:C.tempProduct,onUpdateProduct:U.updateProduct,onHideProductModal:U.hideProductModal},null,8,["product","onUpdateProduct","onHideProductModal"]),(0,s.Wm)($,{ref:"deleteModal","selected-item":C.tempProduct,onDeleteItem:U.deleteProduct,onHideDeleteModal:U.hideDeleteModal},null,8,["selected-item","onDeleteItem","onHideDeleteModal"])],64)}var C=a(9876),U=a(4189),W=a(6294),L=a(9963);const I={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal","data-bs-backdrop":"static","data-bs-keyboard":"false"},$={class:"modal-content border-0"},F={class:"modal-header bg-light"},V=(0,s._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,s._)("span",null,"新增產品")],-1),Z={class:"modal-body"},z={class:"row"},q={class:"col-sm-4"},E=(0,s._)("p",{class:"mb-2"},"商品圖檔",-1),H={class:"mb-3"},S={for:"mainImage",class:"btn btn-outline-warning form-label w-100"},j={key:0,class:"spinner-grow spinner-grow-sm",role:"status"},B=(0,s._)("span",{class:"visually-hidden"},"Loading...",-1),O=[B],Y=["src","alt"],K={class:"mb-3"},N={for:"secondaryImages",class:"btn btn-outline-warning form-label w-100"},T={key:0,class:"spinner-grow spinner-grow-sm",role:"status"},A=(0,s._)("span",{class:"visually-hidden"},"Loading...",-1),R=[A],Q={key:1,class:"d-flex flex-wrap"},G=["src","alt"],J={class:"col-sm-8"},X={class:"mb-3"},ee=(0,s._)("label",{for:"title",class:"form-label"},"標題",-1),te={class:"row gx-2"},ae={class:"mb-3 col-md-6"},se=(0,s._)("label",{for:"category",class:"form-label"},"分類",-1),le=(0,s._)("option",{selected:"",disabled:""},"請選分類",-1),oe=(0,s._)("option",{value:"廚具"},"廚具",-1),ie=(0,s._)("option",{value:"咖啡"},"咖啡",-1),de=(0,s._)("option",{value:"野餐"},"野餐",-1),ne={class:"mb-3 col-md-6"},re=(0,s._)("label",{for:"price",class:"form-label"},"單位",-1),ce=(0,s._)("option",{selected:"",disabled:""},"請選商品單位",-1),ue=(0,s._)("option",{value:"件"},"件",-1),pe=(0,s._)("option",{value:"組"},"組",-1),me={class:"row gx-2"},ge={class:"mb-3 col-md-6"},he=(0,s._)("label",{for:"origin_price",class:"form-label"},"原價",-1),be={class:"mb-3 col-md-6"},_e=(0,s._)("label",{for:"price",class:"form-label"},"售價",-1),fe=(0,s._)("hr",null,null,-1),ye={class:"mb-3"},ve=(0,s._)("label",{for:"description",class:"form-label w-100"},"產品描述",-1),we={class:"mb-3"},Pe=(0,s._)("label",{for:"content",class:"form-label w-100"},"說明內容",-1),ke={class:"mb-3"},xe={class:"form-check"},Me=(0,s._)("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),De={class:"modal-footer"},Ce=(0,s._)("button",{type:"submit",class:"btn btn-secondary"}," 確認 ",-1);function Ue(e,t,a,o,i,d){const n=(0,s.up)("Field"),r=(0,s.up)("ErrorMessage"),c=(0,s.up)("Form");return(0,s.wg)(),(0,s.iD)("div",I,[(0,s.Wm)(c,{class:"modal-dialog modal-xl",role:"document",ref:"productForm",onSubmit:t[12]||(t[12]=t=>(d.reset(),e.$emit("update-product",i.tempProduct),e.$emit("hide-product-modal")))},{default:(0,s.w5)((({errors:e})=>[(0,s._)("div",$,[(0,s._)("div",F,[V,(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...e)=>d.reset&&d.reset(...e))})]),(0,s._)("div",Z,[(0,s._)("div",z,[(0,s._)("div",q,[E,(0,s._)("div",H,[(0,s._)("label",S,[i.uploadingFile&&"main"===i.fileType?((0,s.wg)(),(0,s.iD)("div",j,O)):(0,s.kq)("",!0),(0,s.Uk)(" 上傳主要圖片 ")]),(0,s._)("input",{type:"file",id:"mainImage",name:"file-to-upload",class:"form-control",ref:"mainImageFileInput",accept:"image/*",placeholder:"choose file",style:{display:"none"},onChange:t[1]||(t[1]=e=>d.uploadFile("main"))},null,544)]),i.tempProduct.imageUrl?((0,s.wg)(),(0,s.iD)("img",{key:0,class:"mb-3 img-thumbnail",style:{"max-height":"120px","max-width":"120px","object-fit":"cover"},src:i.tempProduct.imageUrl,alt:i.tempProduct.title},null,8,Y)):(0,s.kq)("",!0),(0,s._)("div",K,[(0,s._)("label",N,[i.uploadingFile&&"secondary"===i.fileType?((0,s.wg)(),(0,s.iD)("div",T,R)):(0,s.kq)("",!0),(0,s.Uk)(" 上傳次要圖片（限2張） ")]),(0,s._)("input",{type:"file",id:"secondaryImages",name:"file-to-upload",class:"form-control",ref:"secondaryImagesFileInput",accept:"image/*",style:{display:"none"},onChange:t[2]||(t[2]=e=>d.uploadFile("secondary"))},null,544)]),i.secondaryImages?((0,s.wg)(),(0,s.iD)("div",Q,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.tempProduct.imagesUrl,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t},[(0,s._)("img",{class:"me-2 mb-3 img-thumbnail",style:{"max-height":"120px","max-width":"120px","object-fit":"cover"},src:e,alt:i.tempProduct.title},null,8,G)])))),128))])):(0,s.kq)("",!0)]),(0,s._)("div",J,[(0,s._)("div",X,[ee,(0,s.Wm)(n,{type:"text",name:"標題",class:(0,l.C_)(["form-control",{"is-invalid":e["標題"]}]),id:"title",placeholder:"請輸入標題",rules:"required",modelValue:i.tempProduct.title,"onUpdate:modelValue":t[3]||(t[3]=e=>i.tempProduct.title=e)},null,8,["class","modelValue"]),(0,s.Wm)(r,{name:"標題",class:"invalid-feedback"})]),(0,s._)("div",te,[(0,s._)("div",ae,[se,(0,s.Wm)(n,{as:"select",class:(0,l.C_)(["form-select",{"is-invalid":e["分類"]}]),"aria-label":"product cateogry select",id:"category",name:"分類",rules:"required",modelValue:i.tempProduct.category,"onUpdate:modelValue":t[4]||(t[4]=e=>i.tempProduct.category=e)},{default:(0,s.w5)((()=>[le,oe,ie,de])),_:2},1032,["class","modelValue"]),(0,s.Wm)(r,{name:"分類",class:"invalid-feedback"})]),(0,s._)("div",ne,[re,(0,s.Wm)(n,{as:"select",class:(0,l.C_)(["form-select",{"is-invalid":e["單位"]}]),"aria-label":"product cateogry select",id:"category",name:"單位",rules:"required",modelValue:i.tempProduct.unit,"onUpdate:modelValue":t[5]||(t[5]=e=>i.tempProduct.unit=e)},{default:(0,s.w5)((()=>[ce,ue,pe])),_:2},1032,["class","modelValue"]),(0,s.Wm)(r,{name:"單位",class:"invalid-feedback"})])]),(0,s._)("div",me,[(0,s._)("div",ge,[he,(0,s.Wm)(n,{type:"number",class:(0,l.C_)(["form-control",{"is-invalid":e["原價"]}]),id:"origin_price",placeholder:"請輸入原價",name:"原價",rules:"required",modelValue:i.tempProduct.origin_price,"onUpdate:modelValue":t[6]||(t[6]=e=>i.tempProduct.origin_price=e),modelModifiers:{number:!0}},null,8,["class","modelValue"]),(0,s.Wm)(r,{name:"原價",class:"invalid-feedback"})]),(0,s._)("div",be,[_e,(0,s.Wm)(n,{type:"number",name:"售價",class:(0,l.C_)(["form-control",{"is-invalid":e["售價"]}]),id:"price",placeholder:"請輸入售價",rules:"required",modelValue:i.tempProduct.price,"onUpdate:modelValue":t[7]||(t[7]=e=>i.tempProduct.price=e),modelModifiers:{number:!0}},null,8,["class","modelValue"]),(0,s.Wm)(r,{name:"售價",class:"invalid-feedback"})])]),fe,(0,s._)("div",ye,[ve,(0,s.wy)((0,s._)("textarea",{type:"text",class:"form-control",id:"description",placeholder:"請輸入產品描述","onUpdate:modelValue":t[8]||(t[8]=e=>i.tempProduct.description=e)},null,512),[[L.nr,i.tempProduct.description]])]),(0,s._)("div",we,[Pe,(0,s.wy)((0,s._)("textarea",{type:"text",class:"form-control",id:"content",placeholder:"請輸入產品說明內容","onUpdate:modelValue":t[9]||(t[9]=e=>i.tempProduct.content=e)},null,512),[[L.nr,i.tempProduct.content]])]),(0,s._)("div",ke,[(0,s._)("div",xe,[Me,(0,s.wy)((0,s._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":t[10]||(t[10]=e=>i.tempProduct.is_enabled=e)},null,512),[[L.e8,i.tempProduct.is_enabled]])])])])])]),(0,s._)("div",De,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal",onClick:t[11]||(t[11]=(...e)=>d.reset&&d.reset(...e))}," 取消 "),Ce])])])),_:1},512)],512)}a(7658);var We=a(1339),Le={props:{product:{type:Object,required:!0,default(){return{}}}},watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl?this.tempProduct.imagesUrl&&(this.secondaryImages=!0):this.tempProduct.imagesUrl=[]}},mixins:[We.Z],data(){return{modal:{},tempProduct:{},secondaryImages:!1,uploadingFile:!1,fileType:""}},methods:{uploadFile(e){this.fileType=e;const t="main"===e?this.$refs.mainImageFileInput.files[0]:this.$refs.secondaryImagesFileInput.files[0],a=new FormData;a.append("file-to-upload",t);const s="https://vue3-course-api.hexschool.io/api/yusan-api/admin/upload";this.uploadingFile=!0,this.$http.post(s,a).then((t=>{if(this.uploadingFile=!1,t.data.success)if("main"===e)this.tempProduct.imageUrl=t.data.imageUrl;else if("secondary"===e){this.secondaryImages=!0;const e=t.data.imageUrl;this.tempProduct.imagesUrl.push(e),this.tempProduct.imagesUrl.length>2&&this.tempProduct.imagesUrl.shift()}})).catch((e=>{throw new Error(e.data.message)}))},reset(){this.$refs.productForm.resetForm()}}},Ie=a(3744);const $e=(0,Ie.Z)(Le,[["render",Ue]]);var Fe=$e,Ve=a(968),Ze=a(640),ze={components:{ProductModal:Fe,DeleteModal:Ve.Z,Pagination:Ze.Z},computed:{...(0,C.rn)(U.Z,["products","pagination","screenLg"]),...(0,C.rn)(W.Z,["isLoading"])},data(){return{tempProduct:{},isNew:!1}},methods:{...(0,C.nv)(U.Z,["getProducts","deleteItem","sendUpdate","onScreenResize","updateScreenWidth","setActivePage"]),...(0,C.nv)(W.Z,["pushMessage"]),openProductModal(e,t){this.tempProduct=e?{}:{...t},this.isNew=e;const a=this.$refs.productModal;a.showModal()},hideProductModal(){const e=this.$refs.productModal;e.hideModal()},updateProduct(e){let t="https://vue3-course-api.hexschool.io/api/yusan-api/admin/product",a="post";const s="product";this.isNew||(t=`https://vue3-course-api.hexschool.io/api/yusan-api/admin/product/${e.id}`,a="put"),this.sendUpdate(s,t,a,e)},openDeleteModal(e){this.tempProduct={...e};const t=this.$refs.deleteModal;t.showModal()},deleteProduct(e){const t=`https://vue3-course-api.hexschool.io/api/yusan-api/admin/product/${e.id}`,a="product";this.deleteItem(a,t)},hideDeleteModal(){const e=this.$refs.deleteModal;e.hideModal()}},created(){this.getProducts(),this.setActivePage("products")},mounted(){this.updateScreenWidth(),this.onScreenResize()}};const qe=(0,Ie.Z)(ze,[["render",D]]);var Ee=qe}}]);
//# sourceMappingURL=320.69efd36b.js.map